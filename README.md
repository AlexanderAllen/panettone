<img src="https://source.unsplash.com/IlbJvIia9aY" alt="Panettone: PHP type generator for Open Api" style="width:100%" />

Image by [@blackieshoot](https://unsplash.com/@blackieshoot) at [Unsplash](https://unsplash.com/)

![GitHub Actions Workflow Status](https://img.shields.io/github/actions/workflow/status/AlexanderAllen/panettone/php.yml) ![Coveralls](https://img.shields.io/coverallsCoverage/github/AlexanderAllen/panettone?style=flat&logo=coveralls&link=https%3A%2F%2Fcoveralls.io%2Fgithub%2FAlexanderAllen%2Fpanettone) [![License](https://poser.pugx.org/alexanderallen/panettone/license)](https://packagist.org/packages/alexanderallen/panettone) [![Version](http://poser.pugx.org/alexanderallen/panettone/version)](https://packagist.org/packages/alexanderallen/panettone)


# Panettone

Panettone is a CLI tool for extracting PHP types from [Open API](https://swagger.io/docs/specification/about/) schemas. Types are generated by interpreting the [data model](https://swagger.io/docs/specification/data-models/) (schema) of Open API documents. Unlike Api Platform's [schema generator](https://packagist.org/packages/api-platform/schema-generator), it does not determine types using [path and operations](https://swagger.io/docs/specification/paths-and-operations/).

## Update July 2024

Panettone is currently not powerful enough to infer and generate the type information for array items,
and probably more advanced OpenAPI use cases (read: very nested structures).

Therefore when an array type is encountered in the OAS spec the generated value objects for PHP simply contain an `array()` as the type. This means you don't know what kind of information is contained in the array. This is the kind of challenge I set out to work on with this project.

I am trying to see if by incorporating [FantasyLand](https://github.com/functional-php/fantasy-land) (functional) patterns I can grant the parsing logic in Panettone the power to output more type-complete value objects.

All the action is happening in the [`test/Unit`](https://github.com/AlexanderAllen/panettone/tree/main/test/Unit) space,
and you can catch me on the Slack [#drupal](drupal.org/slack) channel if you want to join in on the fun _because it's all for fun, no one is going to get paid to do this sh*t!_

## Roadmap July 2024

- Go all ham on asserting functor laws for most if not all FantasyLand category objects. This creates self documented code which then serves as a template for the rest of Panettone. Think of it as a toolshed from which I can then pick the right tool for the job at hand (parsing complex OAS use cases).
- Slowly integrate better PHPStan typing into any FantasyLand examples I come up with. Functional patterns do have a cognitive burden for the unitiated (they sure as hell do for me), and PHPStan has the potential to reduce that burden through type information. Using PHPStan would increase the readability of the Panetonne code itself, not the generated types (those are self-documenting).
- Depending on how the two items above go, I'm thinking about maybe adding to [FantasyLand](https://github.com/functional-php/fantasy-land) more of the types
supported by the [JavaScript FantasyLand](https://github.com/fantasyland/fantasy-land) spec.
- I'd be nice to have native PHP attributes or custom PHPStan types (stubs?)
that can prove the laws for a Functor anywhere it is implemented, maybe even
outside of Panettone (a fantasy!).
- And, whatever else is outstanding on the lonely issue queue (stop using .ini for configs, I'm looking at you).

## Installation

    composer require alexanderallen/panettone
    vendor/bin/panettone --help

As Panettone is not a CLI tool and not a library, I recommend that you install it to your project's `tools` directory, as such:

    mkdir -p tools
    cd tools
    composer require alexanderallen/panettone
    cd ..
    vendor/bin/panettone --help

## Example

    vendor/bin/panettone schema/my-saucy-schema.yaml tmp vendor/alexanderallen/panettone/test/schema/settings.ini

In the example above, Panettone will:

  - Source the `schema/my-saucy-schema.yaml` Open Api file;
  - Output all generated types to the `tmp` directory, and;
  - Use the settings in `vendor/alexanderallen/panettone/test/schema/settings.ini` to guide the type generation process.

## Usage

    vendor/bin/panettone --help

    Description:
      Generate PHP types from Open API sources.

    Usage:
      panettone <input> [<output> [<config>]]

    Arguments:
      input                 Path to Open Api source file in YAML format
      output                Destination for generated files
      config                Path to .ini configuration file [default: "settings.ini"]

    Options:
      -h, --help            Display help for the given command. When no command is given display help for the panettone command
      -q, --quiet           Do not output any message
      -V, --version         Display this application version
          --ansi|--no-ansi  Force (or disable --no-ansi) ANSI output
      -n, --no-interaction  Do not ask any interactive question
      -v|vv|vvv, --verbose  Increase the verbosity of messages: 1 for normal output, 2 for more verbose output and 3 for debug

    Help:
      Generates PHP types from a Open API source.

## Configuration

Panettone is configured by placing a `settings.ini` in the directory from where you are executing Panettone, usually where your `composer.json` is.

Below is a list of the currently supported configuration options. Do note that the `[file], [class]` segments
are required when using the options listed under them.

    ; Enable detailed logging during type generation.
    debug = true

    [file]
    ; Path where to dump the generated file.
    output_path = "tmp"

    ; Namespace for all generated files.
    namespace = "Panettone"

    ; Comment to apply to every generated file.
    comment = "Example file comments are configured in settings.ini."

    [class]
    nullable = true
    default = null


## Testing

Tests are located in the `tests` directory. PHPUnit is installed separately in the `tools/phpunit` directory.

To test, first use Composer to install PHPUnit then run the test script.

    composer -d tools/phpunit install
    . tools/phpunit/test

## Coverage

Coverage details are gathered during testing in Github and [pushed to Coveralls](https://coveralls.io/github/AlexanderAllen/panettone).
